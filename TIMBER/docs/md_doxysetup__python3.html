<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TIMBER: Getting a Python 3 compatible version of ROOT</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TIMBER
   &#160;<span id="projectnumber">beta</span>
   </div>
   <div id="projectbrief">Tree Interface for Making Binned Events with RDataFrame</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Getting a Python 3 compatible version of ROOT </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>For those unaware, ROOT must be built with a specific version of python. Most builds use Python 2.7 for the sake of backwards compatibility with older python scripts. However, Python 2.7 reached end-of-life on January 1st, 2020 and is no longer supported. Given this and the fact that Python 3 has a lot of very nice features, everyone should start converting as soon as possible.</p>
<p>This is a guide to ensure your environment is ready for the switch.</p>
<p><b>NOTE:</b> TIMBER is currently compatible with both Python 2.7 and Python 3 but support for Python 2.7 will soon be dropped.</p>
<h2>Local/personal computer</h2>
<p>ROOT version 6.22 has introduced support for being compatible with Python 2.7 and Python 3 simultaneously. More information can be found <a href="https://root.cern/install/build_from_source/#root-python-and-pyroot">here</a>. The simplest solution for your personal computer may be to just install v6.22 (either by building from source or downloading the binary). General install instructions can be found <a href="https://root.cern/install/">here</a>.</p>
<p>If you'd like to use an older version of ROOT, you'll need to build from source with the cmake option <code>-DPYTHON_EXECUTABLE=path/to/python</code> specified. Read <a href="https://root.cern/install/build_from_source/#root-python-and-pyroot">more</a> for details.</p>
<h2>With CMSSW on LXPLUS or LPC</h2>
<p>WARNING: THESE INSTRUCTIONS DO NOT WORK CONSISTENTLY ACROSS USE CASES.</p>
<p>There's no good resource that explains which CMSSW versions have which python and ROOT versions (if you know of one, please send it to me and I'll add it here!). One can parse the information in <code>cvmfs</code> but these instructions are so you can avoid that! CMSSW versions almost always come with some version of Python 2.7 and Python 3.x but current popular CMSSW versions have ROOT versions older than v6.22 and it is almost always compiled for Python 2.7 for the sake of backwards compatibility with user scripts.</p>
<p>This is incredibly unfortunate given that Python 3 has been available so long and that Python 2.7 is explicitly not supported anymore. The best way to convince others that CMS as a collaboration needs to switch off of outdated software is to convert yourself - even if you have to play tricks (like the following one) to get there.</p>
<p>The trick to get a Python 3 compatible version of ROOT is to just source the version of ROOT you want after your <code>cmsenv</code> by sourcing another root version like <code>source /cvmfs/cms.cern.ch/slc7_amd64_gcc820/lcg/root/6.22.00/bin/thisroot.sh</code>.</p>
<p>This grabs the nice v6.22 so you can still use your Python 2.7 while you convert to Python 3. The problem is that this build of v6.22 is for Python <b>3.8</b> compatibility which means one needs a CMSSW with Python 3.8. Feel free to test your favorite versions of CMSSW but CMSSW_11_1_4 was the newest version of CMSSW (excluding <code>_pre</code> versions) that had Python 3.8 (at the time of writing).</p>
<p>Here's the full setup. </p><div class="fragment"><div class="line">cmsrel CMSSW_11_4_1 # has python 3.8 (root version we grab will be compiled for python3.8 but not python3.6)</div><div class="line">cd CMSSW_11_4_1/src</div><div class="line">cmsenv</div><div class="line">source /cvmfs/cms.cern.ch/slc7_amd64_gcc820/lcg/root/6.22.00/bin/thisroot.sh # compiled for python2.7 and python3.8 (not for python3.6 which is why we need CMSSW_11_4_1)</div><div class="line">python3 -c &quot;import ROOT&quot; # test python3 - should return nothing</div><div class="line">python2.7 -c &quot;import ROOT&quot; # test python2.7 - should return nothing</div></div><!-- fragment --><p>Of course, this means that you need to source your root version manually after cmsenv. My recommendation around this is to do one of two things:</p><ol type="1">
<li>Setup an alias in your <code>.bashrc</code> like <code>alias cmsenv_py3='cmsenv; source /cvmfs/cms.cern.ch/slc7_amd64_gcc820/lcg/root/6.22.00/bin/thisroot.sh'</code>. Then use this alias instead of <code>cmsenv</code>.</li>
<li>Setup a python virtualenv and modify the activate script to run <code>source /cvmfs/cms.cern.ch/slc7_amd64_gcc820/lcg/root/6.22.00/bin/thisroot.sh</code> at the end. <div class="fragment"><div class="line">cmsenv</div><div class="line">python3 -m virtualenv pyroot3</div><div class="line">echo -e &quot;\nsource /cvmfs/cms.cern.ch/slc7_amd64_gcc820/lcg/root/6.22.00/bin/thisroot.sh&quot; &gt;&gt; pyroot3/bin/activate</div><div class="line">source pyroot3/bin/activate</div></div><!-- fragment --> With this option, you'll need to remember to activate the virtualenv every time after you cmsenv but in general, virtualenvs are good to use so you can install other python packages via pip.</li>
<li>Combine (1) and (2) so that the alias also does the virtualenv activating.</li>
</ol>
<p>(optional) If you want to be really cool, also modify the <code>deactivate</code> function in <code>pyroot3/bin/activate</code> so that it resets the root version to the original for <code>CMSSW_11_4_1</code>. This is mainly for fun since you could perform the reset by calling <code>cmsenv</code> as well. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
