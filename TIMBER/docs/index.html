<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TIMBER: TIMBER</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TIMBER
   &#160;<span id="projectnumber">beta</span>
   </div>
   <div id="projectbrief">Tree Interface for Making Binned Events with RDataFrame</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TIMBER </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://lcorcodilos.github.io/TIMBER/">Full Documentation</a></p>
<p>TIMBER (Tree Interface for Making Binned Events with RDataFrame) is an easy-to-use and fast python analysis framework used to quickly process CMS data sets. Default arguments assume the use of the NanoAOD format but any ROOT TTree can be processed.</p>
<h2>Quick install</h2>
<p>Despite the fact that Python 2.7 reached end-of-life on January 1st, 2020, it is still the dominant version used by CMS. If you need CMSSW (ex. for JME modules), Python 2.7 is recommended. Otherwise, please take this opportunity to start using Python 3! Remember to make sure your ROOT version has been built with Python 3 compatibility. For information on how to do this, see <a class="el" href="md_doxysetup__python3.html">this explanation</a>. Though this does not always work consistently when CMSSW code is needed.</p>
<p>Working in a virtual environment is also recommended. Below are the commands for using virtualenv but you're obviously free to use your favorite tool for the job (you can install virtualenv for Python 3 with <code>pip install virtualenv</code> (<code>pip3</code> for Python 3)).</p>
<div class="fragment"><div class="line">python -m virtualenv timber-env</div><div class="line">source timber-env/bin/activate</div><div class="line">git clone https://github.com/lcorcodilos/TIMBER.git</div><div class="line">cd TIMBER</div><div class="line">source setup.sh</div></div><!-- fragment --><p>Some C++ modules also have the <a href="https://www.boost.org/">boost library</a> as a dependency. The internet has plenty instructions on how to install boost. The standard <code>apt-get</code> (Ubuntu) and <code>brew</code> (macOS) package managers support install as well.</p>
<h2>The RDataFrame Backbone</h2>
<p>TIMBER's speed comes from the use of <a href="https://root.cern/doc/master/classROOT_1_1RDataFrame.html">ROOT's RDataFrame</a>. RDataFrame offers "multi-threading and other low-level optimisations" which make analysis level processing faster and more efficient than traditional python <code>for</code> loops. However, RDataFrame derives its speed from its C++ back-end and while an RDataFrame object can be instantiated and manipulated in python, any actions on it are written in C++ (even if you're using python).</p>
<h2>No more <code>for</code> loops</h2>
<p>Using RDataFrame means a fundamental re-thinking of how we treat a block of data or simulation. Instead of looping over the events or entries of a TTree (or other data format), the TTree is converted into a table called the "data frame". A user then books a number of "lazy" actions on the data frame such as filtering out events or calculating new values. These actions aren't performed though until the data frame needs to be evaluated (ex. you ask to plot a histogram from it).</p>
<p>In this way, there are no more <code>for</code> loops and instead just actions on the data frame table that transform it into a final table of values that the analyzer cares about.</p>
<h2>Anatomy of a data frame</h2>
<p>Each row of the table is a separate event and each column is a different variable in the event (a branch in TTree terms). Columns can be single values or vectors (specifically <a href="https://root.cern.ch/doc/v614/classROOT_1_1VecOps_1_1RVec.html">ROOT::VecOps:RVec</a>).</p>
<p>Since each row is an event, vectors are necessary for the case of multiple of the same physics object in an event - for example, multiple electrons.</p>
<p><b>NOTE</b> NanoAOD orders these vectors in \(p_T\) of the objects. So if you'd like the \(\eta\) of the leading electron, it is stored as <code>Electron_eta[0]</code></p>
<p>This can make accessing values tricky! For example, if there's one electron in an event and the analyzer asks for <code>Electron_eta[1]</code>, the computer will return a seg fault. These are the types of problems that TIMBER attempts to solve (even if it's just by users sharing their experiences).</p>
<h2>Happy Analyzers</h2>
<p>TIMBER is meant to keep both the processing fast via RDataFrame and the analyzer fast via python scripting.</p>
<p>To maintain python's appeal in HEP as a quick scripting language, TIMBER handles interfacing with RDataFrame so the analyzer can focus on writing their analysis.</p>
<p>TIMBER automates opening one or many ROOT files, calculating the number of events generated (provided the ROOT files are NanoAOD simulation), loading in C++ scripts for use while looping over the data frame, and grouping actions for easy manipulation.</p>
<p>In addition, TIMBER treats each step in the RDataFrame processing as a "node" and keeps track of these nodes as a larger tree. Each action (or group of actions) performed on a node produces another node and nodes store information about their parents or children. This makes it possible to write tools like <code>Nminus1()</code> which takes as input a node and a group of cuts to apply and returns N new nodes, each with every cut but one applied.</p>
<p>Finally, the RDataFrame for each node is always kept easily accessible so that any of the <a href="https://root.cern/doc/master/classROOT_1_1RDataFrame.html">native RDataFrame tools</a> are at the user's fingertips.</p>
<h2>Sharing is caring</h2>
<p>TIMBER includes a repository of common algorithms used frequently in CMS which access scale factors, calculate pileup weights, and more. These are all written in C++ for use in <code>Cut</code> and <code>Define</code> arguments and are provided so that users have a common tool box to share. Additionally, the AnalysisModules folder welcomes additions of custom C++ modules on a per-analysis basis so that the code can be properly archived for future reference and for sharing with other analyzers. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
